// Built at: 2025/11/25 21:54:13
var g=r=>async(e,t)=>{let s=o=>async()=>{let n=o===r.length?t:r[o];if(n)return await n(e,s(o+1))};return s(0)()};function h(r){return typeof r!="object"||r===null?String(r):r instanceof Error&&r.cause?`${r.toString()} { [cause]: ${h(r.cause)} }`:Array.isArray(r)?JSON.stringify(r):typeof r.toString=="function"&&r.toString!==Object.prototype.toString?r.toString():JSON.stringify(r)}var d=class r{static getInstance(){if(!r.instance){let e="Surge";if(typeof $loon<"u")e="Loon";else if(typeof $task<"u")throw new Error("QuantumultX is not supported");r.instance=r.classNames[e]()}return r.instance}static classNames={Surge:()=>new f,Loon:()=>new b};static instance;request;response;argument=Object.create(null);state=Object.create(null);logLevels={debug:1,info:2,warn:3,error:4,off:5};logLevel=this.logLevels.error;_url;get url(){return this._url||(this._url=new URL(this.request.url)),this._url}get path(){return this.url.pathname}constructor(){this.request=this.createRequest(typeof $request<"u"?$request:null),this.response=this.createResponse(typeof $response<"u"?$response:null)}getJSON(e){let t=this.getVal(e);return t?JSON.parse(t):null}setJSON(e,t){this.setVal(JSON.stringify(e),t)}log(...e){console.log(e.map(t=>h(t)).join(" "))}debug(...e){this.logLevel>this.logLevels.debug||this.log("[DEBUG]",...e)}info(...e){this.logLevel>this.logLevels.info||this.log("[INFO]",...e)}warn(...e){this.logLevel>this.logLevels.warn||this.log("[WARN]",...e)}error(...e){this.logLevel>this.logLevels.error||this.log("[ERROR]",...e)}exit(){$done({})}},f=class extends d{createRequest(e){return Object.create(e,{bodyBytes:{get(){return this.body},set(t){this.body=t}}})}createResponse(e){return Object.create(e,{bodyBytes:{get(){return this.body},set(t){this.body=t}}})}initArgument(e){if(Object.assign(this.argument,e),typeof $argument=="string"){try{Object.assign(this.argument,JSON.parse($argument))}catch(t){console.log(t)}"logLevel"in this.argument&&(this.logLevel=Number(this.argument.logLevel)??this.logLevels.error)}}getVal(e){return $persistentStore.read(e)}setVal(e,t){return $persistentStore.write(e,t)}fetch(e){let{method:t,body:s,timeout:o=5,...n}=e;return new Promise((i,u)=>{$httpClient[t.toLowerCase()]({...n,body:s,"binary-mode":s instanceof Uint8Array,timeout:o},(a,p,c)=>{if(a)return u(a);i(this.createResponse({...p,body:c}))})})}notify(e="",t="",s="",o={}){let{openUrl:n,clipboard:i,mediaUrl:u,dismiss:a,sound:p=!0}=o,c={url:n,text:i,"media-url":u,"auto-dismiss":a,sound:p};n?c.action="open-url":i&&(c.action="clipboard"),$notification.post(e,t,s,c)}ungzip(e){return $utils.ungzip(e)}done(e){$done({...e})}abort(){$done({abort:!0})}},b=class extends f{initArgument(e){super.initArgument(e),typeof $argument=="object"&&(Object.assign(this.argument,$argument),"logLevel"in this.argument&&(this.logLevel=this.logLevels[this.argument.logLevel]??this.logLevels.error))}fetch(e){return e.timeout=(e.timeout??5)*1e3,e.alpn="h2",super.fetch(e)}notify(e="",t="",s="",o={}){let{openUrl:n,mediaUrl:i,clipboard:u,delay:a}=o,p={openUrl:n,mediaUrl:i,clipboard:u};$notification.post(e,t,s,p,a)}abort(){$done()}};var y=class{middleware=[];use(e){return this.middleware.push(e),this}run(){let e=d.getInstance();g(this.middleware)(e).catch(t=>e.error(t,e.request.url)).finally(()=>e.exit())}};var l=class{path;stack;constructor(e,t){this.path=e,this.stack=t}};var m=class{stack=[];matchPath;constructor(e={}){this.matchPath=e.matchPath||((t,s)=>t.path===s.path)}use(...e){return this.register("",e)}add(e,...t){return this.register(e,t)}routes(){return(e,t)=>{let s=this.match(e);if(s.length===0)return t();let o=s.flatMap(n=>n.stack);return g(o)(e,t)}}match(e){return this.stack.filter(t=>t.path===""||this.matchPath(t,e))}register(e,t){if(Array.isArray(e))for(let s of e)this.stack.push(new l(s,t));else this.stack.push(new l(e,t));return this}};var x=async(r,e)=>{await e(),r.done({response:r.response})};var R=new m({matchPath:(r,e)=>e.request.url.endsWith(r.path)});R.add("/getAdList",x,r=>{let e=s=>s==="0007"?'{"materialsList":[{"billMaterialsId":"1","filePath":"#","creativeType":1}],"advertParam":{"skipTime":1}}':s==="G0054"?'{"code":"00","materialsList":[{}]}':'{"code":"00","message":"0"}',t=JSON.parse(r.request.body);r.response.body=e(t.placementNo)});R.add("/mgw.htm",r=>{let e=["com.cars.otsmobile.newHomePageBussData"],t=r.request.headers,s=t["operation-type"]??t["Operation-Type"];e.includes(s)?r.abort():r.exit()});var v=R;var w=new y;w.use(v.routes());var O=w;O.run();
